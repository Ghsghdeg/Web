<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales/uk.global.min.js"></script>
  <style>
    .header-icons {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .language-switcher {
      margin-left: 15px;
    }

    .language-switcher button {
      padding: 6px 14px;
      font-size: 14px;
      background: linear-gradient(to right, #00b4db, #0083b0);
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background 0.3s ease;
      font-weight: 500;
    }

    .language-switcher button:hover {
      background: linear-gradient(to right, #0083b0, #00b4db);
    }

    .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="logo">–ê–≤—Ç–æ<span>–®–∫–æ–ª–∞</span></div>
      <nav>
        <ul>
          <li><a href="Main.html">–ì–æ–ª–æ–≤–Ω–∞</a></li>
          <li><a href="test.html">–¢–µ—Å—Ç–∏</a></li>
          <li><a href="comments.html">–í—ñ–¥–≥—É–∫–∏</a></li>
          <li><a href="Contact.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
        </ul>
      </nav>
        <div class="language-switcher">
          <button onclick="toggleLang()">üåê UKR / ENG</button>
      </div>
      
    </div>

  </header>

  <main class="profile-container">
    <h1 id="user-name">–ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h1>

    <section class="progress-section">
      <h2 id="progressTitle">–ü—Ä–æ–≥—Ä–µ—Å –Ω–∞–≤—á–∞–Ω–Ω—è</h2>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill" style="width: 40%;">40%</div>
      </div>
    </section>

    <section class="calendar-section">
      <h2 id="calendarTitle">–ö–∞–ª–µ–Ω–¥–∞—Ä –∑–∞–Ω—è—Ç—å</h2>
      <label for="topic-select" id="topicLabel">–û–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É:</label>
      <select id="topic-select">
        <option value="" id="selectPlaceholder">-- –û–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É --</option>
      </select>
      <div id="calendar"></div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 –ê–≤—Ç–æ—à–∫–æ–ª–∞. –£—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω–æ.</p>
  </footer>

  <script>
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (currentUser) {
      document.getElementById('user-name').innerText = `–ü—Ä–æ—Ñ—ñ–ª—å: ${currentUser.name || currentUser.email}`;

      fetch(`https://pdd-api.duckdns.org/api/users/progress/${currentUser.id}`)
        .then(res => res.json())
        .then(data => {
          const percent = data.progress;
          const progressBar = document.getElementById('progress-fill');
          progressBar.style.width = percent + '%';
          progressBar.innerText = percent + '%';
        })
        .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É:', error));
    }

    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('calendar');

      fetch('https://pdd-api.duckdns.org/api/topics')
        .then(res => res.json())
        .then(topics => {
          const select = document.getElementById('topic-select');
          topics.forEach(topic => {
            const option = document.createElement('option');
            option.value = topic.testID;
            option.textContent = topic.title;
            select.appendChild(option);
          });
        })
        .catch(error => {
          console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–µ–º–∏:', error);
        });

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'uk',
        selectable: true,
        events: `https://pdd-api.duckdns.org/api/schedule/user/${currentUser.id}`,
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },

        select: function (info) {
          const topicID = +document.getElementById('topic-select').value;
          if (!topicID) {
            alert(lang === 'uk' ? '–û–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É –∑–∞–Ω—è—Ç—å!' : 'Please select a topic!');
            return;
          }

          fetch('https://pdd-api.duckdns.org/api/schedule', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              userID: currentUser.id,
              topicID: topicID,
              scheduledDate: info.startStr,
              reminderEnabled: true
            })
          })
          .then(res => {
            if (res.ok) {
              calendar.refetchEvents();
              alert((lang === 'uk' ? '–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –Ω–∞' : 'Reminder will be sent to') + ` ${currentUser.email}`);
            } else {
              alert(lang === 'uk' ? '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó' : 'Error saving event');
            }
          })
          .catch(err => {
            console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É:', err);
            alert(lang === 'uk' ? '–°–µ—Ä–≤–µ—Ä –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î' : 'Server is not responding');
          });
        },

        eventClick: function (arg) {
          if (confirm(lang === 'uk' ? '–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –ø–æ–¥—ñ—é?' : 'Delete this event?')) {
            fetch(`https://pdd-api.duckdns.org/api/schedule/${arg.event.id}`, {
              method: 'DELETE'
            })
            .then(res => {
              if (res.ok) calendar.refetchEvents();
              else alert(lang === 'uk' ? '–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–¥—ñ—é' : 'Failed to delete event');
            });
          }
        }
      });

      calendar.render();
    });

    const translations = {
      uk: {
        progressTitle: "–ü—Ä–æ–≥—Ä–µ—Å –Ω–∞–≤—á–∞–Ω–Ω—è",
        calendarTitle: "–ö–∞–ª–µ–Ω–¥–∞—Ä –∑–∞–Ω—è—Ç—å",
        topicLabel: "–û–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É:",
        selectPlaceholder: "-- –û–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É --",
      },
      en: {
        progressTitle: "Learning Progress",
        calendarTitle: "Schedule Calendar",
        topicLabel: "Select Topic:",
        selectPlaceholder: "-- Select Topic --",
      }
    };

    let lang = "uk";

    function toggleLang() {
      lang = lang === "uk" ? "en" : "uk";
      applyLang();
    }

    function applyLang() {
      const t = translations[lang];
      document.getElementById("progressTitle").textContent = t.progressTitle;
      document.getElementById("calendarTitle").textContent = t.calendarTitle;
      document.getElementById("topicLabel").textContent = t.topicLabel;
      document.getElementById("selectPlaceholder").textContent = t.selectPlaceholder;
    }

    document.addEventListener("DOMContentLoaded", () => {
      applyLang();
    });
  </script>
</body>
</html>
