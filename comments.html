<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Відгуки користувачів</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">Авто<span>Ш</span>кола</div>
            <nav>
                <ul>
                    <li><a href="Main.html">Головна</a></li>
                    <li><a href="pdr.html">ПДР</a></li>
                    <li><a href="profile.html">Профіль</a></li>
                    <li><a href="reviews.html" class="active">Відгуки</a></li>
                    <li><a href="contact.html">Контакти</a></li>
                </ul>
            </nav>
        </div>
    </header>

    </section>
    <section class="profile-container">
        <h1>Відгуки користувачів</h1>
        <div id="reviews-list" class="chat-window"></div>
    
        <form id="review-form" class="chat-form">
            <textarea id="review-text" placeholder="Напишіть ваш відгук..." required></textarea>
            <button type="submit">Відправити</button>
        </form>
        
        <script>
        document.addEventListener("DOMContentLoaded", () => {
            const container = document.getElementById("reviews-list");
            const form = document.getElementById("review-form");
            const textarea = document.getElementById("review-text");
        
            
            const currentUserID = JSON.parse(localStorage.currentUser).id;  
        
            function loadReviews() {
                fetch("https://pdd-api.duckdns.org/api/comments")
                    .then(response => response.json())
                    .then(data => {
                        container.innerHTML = "";
                        if (!data.length) {
                            container.innerHTML = "<p>Наразі немає відгуків.</p>";
                            return;
                        }
        
                        data.forEach(review => {
                            const div = document.createElement("div");
                            div.classList.add("contact-item");
                            div.innerHTML = `
                                <h3>${review.userName || 'Користувач'}</h3>
                                <p><strong>Дата:</strong> ${new Date(review.datePosted).toLocaleDateString()}</p>
                                <p>${review.text}</p>
                            `;
                            container.appendChild(div);
                        });
                        container.scrollTop = container.scrollHeight;
                    })
                    .catch(() => {
                        container.innerHTML = "<p>Помилка завантаження відгуків.</p>";
                    });
            }
        
            loadReviews();
        
            form.addEventListener("submit", e => {
                e.preventDefault();
                const text = textarea.value.trim();
                if (!text) return;
        
                fetch("https://pdd-api.duckdns.org/api/comments", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        userID: currentUserID,
                        text: text
                    })
                })
                .then(response => {
                    if (!response.ok) throw new Error("Помилка відправки відгуку");
                    return response.json();
                })
                .then(data => {
                    textarea.value = "";
                    loadReviews();
                })
                .catch(err => {
                    alert("Не вдалося надіслати відгук. Спробуйте пізніше.");
                    console.error(err);
                });
            });
        });
        </script>
        
    
</body>
</html>
