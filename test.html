<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Тести - Автошкола</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">Авто<span>Школа</span></div>
            <nav>
                <ul>
                    <li><a href="Main.html">Головна</a></li>
                    <li><a href="pdr.html">ПДР</a></li> 
                    <li><a href="test.html"class="active">Тести</a></li>
                    <li><a href="comments.html">Відгуки</a></li>
                    <li><a href="Contact.html" >Контакти</a></li>
                    
                </ul>
            </nav>
        </div>
    </header>
    <div class="container">
        <h1>Виберіть тип тестування</h1>

        <div class="tab-buttons">
            <button id="btn-topics" class="active">Тести по темах</button>
            <button id="btn-random">Випадкове тестування</button>
        </div>

        <div id="topics-section" class="content-section">
            <label>Оберіть тему:</label>
            <ul class="topic-list" id="topic-list">
                <!-- Теми підвантажуються сюди -->
            </ul>
            <button class="start-test" id="start-topic-test" disabled>Почати тест</button>
        </div>

        <div id="random-section" class="content-section" style="display:none;">
            <label>Оберіть кількість питань:</label>
            <input type="number" id="random-question-count" min="1" max="50" value="10" />
            <button class="start-test" id="start-random-test">Почати тест</button>
        </div>

        <div id="message-box" class="message" style="display:none;"></div>
    </div>

    <script>
        const API_BASE = "https://pdd-api.duckdns.org/api/tests"; // або ваш хост
    
        // ==== 1. Перемикач режимів ====
        document.getElementById('btn-topics').addEventListener('click', () => {
            document.getElementById('topics-section').style.display = 'block';
            document.getElementById('random-section').style.display = 'none';
            document.getElementById('btn-topics').classList.add('active');
            document.getElementById('btn-random').classList.remove('active');
        });
    
        document.getElementById('btn-random').addEventListener('click', () => {
            document.getElementById('topics-section').style.display = 'none';
            document.getElementById('random-section').style.display = 'block';
            document.getElementById('btn-random').classList.add('active');
            document.getElementById('btn-topics').classList.remove('active');
        });
    
        // ==== 2. Отримати список тем ====
        async function loadTopics() {
            try {
                const response = await fetch(`${API_BASE}/topics`);
                const topics = await response.json();
                const list = document.getElementById('topic-list');
                list.innerHTML = '';
    
                topics.forEach(topic => {
                    const li = document.createElement('li');
                    li.textContent = topic.title || topic.Title;
                    li.dataset.id = topic.topicID || topic.TopicID;
                    li.addEventListener('click', () => {
                        [...list.children].forEach(c => c.classList.remove('selected'));
                        li.classList.add('selected');
                        document.getElementById('start-topic-test').disabled = false;
                    });
                    list.appendChild(li);
                });
            } catch (err) {
                alert("Не вдалося завантажити теми");
                console.error(err);
            }
        }
    
        // ==== 3. Почати тест по темі ====
        async function startTestByTopic() {
            const selected = document.querySelector('#topic-list li.selected');
            if (!selected) return;
    
            const topicId = selected.dataset.id;
            const response = await fetch(`${API_BASE}/by-topic/${topicId}`);
            const questions = await response.json();
            launchTest(questions);
        }
    
        // ==== 4. Випадковий тест ====
        async function startRandomTest() {
            const count = document.getElementById('random-question-count').value;
            const response = await fetch(`${API_BASE}/random/${count}`);
            const questions = await response.json();
            launchTest(questions);
        }
    
        // ==== 5. Відобразити тест ====
        function launchTest(questions) {
            // Перейти на окрему сторінку з передачею JSON через sessionStorage
            console.log("questions from API:", questions);

            sessionStorage.setItem('testQuestions', JSON.stringify(questions));
            window.location.href = 'test-run.html';
        }
    
        document.getElementById('start-topic-test').addEventListener('click', startTestByTopic);
        document.getElementById('start-random-test').addEventListener('click', startRandomTest);
    
        // Початкове завантаження тем
        loadTopics();
    </script>
    

</body>
</html>
