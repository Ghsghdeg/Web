<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–¢–µ—Å—Ç–∏ - –ê–≤—Ç–æ—à–∫–æ–ª–∞</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">–ê–≤—Ç–æ<span>–®–∫–æ–ª–∞</span></div>
            <nav>
                <ul>
                    <li><a href="Main.html">–ì–æ–ª–æ–≤–Ω–∞</a></li>
                    <li><a href="pdr.html">–ü–î–†</a></li> 
                    <li><a href="test.html" class="active">–¢–µ—Å—Ç–∏</a></li>
                    <li><a href="comments.html">–í—ñ–¥–≥—É–∫–∏</a></li>
                    <li><a href="Contact.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
                </ul>
            </nav>
            <div class="header-icons">
            </div>
            <div class="language-switcher">
                <button onclick="toggleLang()">üåê UKR / ENG</button>
            </div>
        </div>
    </header>
    <div class="container">
        <h1 id="title">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</h1>

        <div class="tab-buttons">
            <button id="btn-topics" class="active">–¢–µ—Å—Ç–∏ –ø–æ —Ç–µ–º–∞—Ö</button>
            <button id="btn-random">–í–∏–ø–∞–¥–∫–æ–≤–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</button>
        </div>

       <div id="topics-section" class="content-section">
            <label id="label-difficulty">–û–±–µ—Ä—ñ—Ç—å —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:</label>
            <select id="difficulty-select">
                <option value="1">–õ–µ–≥–∫–∞</option>
                <option value="2">–ù–æ—Ä–º–∞–ª—å–Ω–∞</option>
                <option value="3">–í–∞–∂–∫–∞</option>
            </select>
           
    <label id="label-topic">–û–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É:</label>
            <ul class="topic-list" id="topic-list">
                <!-- –¢–µ–º–∏ –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —Å—é–¥–∏ -->
            </ul>
            <button class="start-test" id="start-topic-test" disabled>–ü–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç</button>
        </div>

        <div id="random-section" class="content-section" style="display:none;">
            <label id="label-random-count">–û–±–µ—Ä—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∏—Ç–∞–Ω—å:</label>
            <input type="number" id="random-question-count" min="1" max="50" value="10" />
            <label id="label-random-difficulty">–û–±–µ—Ä—ñ—Ç—å —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:</label>
            <select id="random-difficulty-select">
                <option value="1">–õ–µ–≥–∫–∞</option>
                <option value="2">–ù–æ—Ä–º–∞–ª—å–Ω–∞</option>
                <option value="3">–í–∞–∂–∫–∞</option>
            </select>
            <button class="start-test" id="start-random-test">–ü–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç</button>
        </div>

        <div id="message-box" class="message" style="display:none;"></div>
    </div>

    <script>
        const API_BASE = "https://pdd-api.duckdns.org/api/tests";

        // –¢–µ–∫—Å—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª–∞–¥—É
        const translations = {
            uk: {
                title: "–í–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è",
                btnTopics: "–¢–µ—Å—Ç–∏ –ø–æ —Ç–µ–º–∞—Ö",
                btnRandom: "–í–∏–ø–∞–¥–∫–æ–≤–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è",
                labelTopic: "–û–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É:",
                labelDifficulty: "–û–±–µ—Ä—ñ—Ç—å —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:",
                startTopicTest: "–ü–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç",
                labelRandomCount: "–û–±–µ—Ä—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∏—Ç–∞–Ω—å:",
                labelRandomDifficulty: "–û–±–µ—Ä—ñ—Ç—å —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:",
                startRandomTest: "–ü–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç",
                errLoadTopics: "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ–º. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞.",
                alertSelectTopic: "–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è",
                alertNoTestId: "–ü–æ–º–∏–ª–∫–∞: –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ ID —Ç–µ–º–∏",
                alertLoadTestError: "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ç–µ—Å—Ç—É:",
                alertRandomTestError: "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ç–µ—Å—Ç—É. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑."
            },
            en: {
                title: "Select Test Type",
                btnTopics: "Tests by Topics",
                btnRandom: "Random Test",
                labelTopic: "Select Topic:",
                labelDifficulty: "Select Difficulty:",
                startTopicTest: "Start Test",
                labelRandomCount: "Select Number of Questions:",
                labelRandomDifficulty: "Select Difficulty:",
                startRandomTest: "Start Test",
                errLoadTopics: "Error loading topics. Check your server connection.",
                alertSelectTopic: "Please select a topic for testing",
                alertNoTestId: "Error: Topic ID not found",
                alertLoadTestError: "Error loading test:",
                alertRandomTestError: "Error loading test. Please try again."
            }
        };

        let lang = "uk";

        function applyLang() {
            const t = translations[lang];
            document.getElementById("title").textContent = t.title;
            document.getElementById("btn-topics").textContent = t.btnTopics;
            document.getElementById("btn-random").textContent = t.btnRandom;
            document.getElementById("label-topic").textContent = t.labelTopic;
            document.getElementById("label-difficulty").textContent = t.labelDifficulty;
            document.getElementById("start-topic-test").textContent = t.startTopicTest;
            document.getElementById("label-random-count").textContent = t.labelRandomCount;
            document.getElementById("label-random-difficulty").textContent = t.labelRandomDifficulty;
            document.getElementById("start-random-test").textContent = t.startRandomTest;
        }

        function toggleLang() {
            lang = lang === "uk" ? "en" : "uk";
            applyLang();
        }

        document.getElementById('btn-topics').addEventListener('click', () => {
            document.getElementById('topics-section').style.display = 'block';
            document.getElementById('random-section').style.display = 'none';
            document.getElementById('btn-topics').classList.add('active');
            document.getElementById('btn-random').classList.remove('active');
        });

        document.getElementById('btn-random').addEventListener('click', () => {
            document.getElementById('topics-section').style.display = 'none';
            document.getElementById('random-section').style.display = 'block';
            document.getElementById('btn-random').classList.add('active');
            document.getElementById('btn-topics').classList.remove('active');
        });

        async function loadTopics() {
            try {
                const response = await fetch(`${API_BASE}/topics`);

                if (!response.ok) {
                    throw new Error(translations[lang].errLoadTopics);
                }

                const topics = await response.json();

                if (!Array.isArray(topics) || topics.length === 0) {
                    throw new Error(translations[lang].errLoadTopics);
                }

                const list = document.getElementById('topic-list');
                list.innerHTML = '';

                topics.forEach(topic => {
                    const topicId = topic.testID || topic.TestID;
                    const title = topic.title || topic.Title;

                    if (!topicId) return;

                    const li = document.createElement('li');
                    li.textContent = title || `–¢–µ–º–∞ ${topicId}`;
                    li.dataset.id = topicId;
                    li.addEventListener('click', () => {
                        [...list.children].forEach(c => c.classList.remove('selected'));
                        li.classList.add('selected');
                        document.getElementById('start-topic-test').disabled = false;
                    });
                    list.appendChild(li);
                });
            } catch (err) {
                alert(translations[lang].errLoadTopics);
                const list = document.getElementById('topic-list');
                list.innerHTML = `<li style="color: red;">${translations[lang].errLoadTopics}</li>`;
            }
        }

        async function startTestByTopic() {
            const selected = document.querySelector('#topic-list li.selected');
            if (!selected) {
                alert(translations[lang].alertSelectTopic);
                return;
            }

            const testId = selected.dataset.id;
            const difficulty = document.getElementById('difficulty-select').value;
            if (!testId) {
                alert(translations[lang].alertNoTestId);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/by-test/${testId}`);

                if (!response.ok) {
                    throw new Error(`${translations[lang].alertLoadTestError} ${response.status}`);
                }

                const questions = await response.json();

                if (!questions || !Array.isArray(questions) || questions.length === 0) {
                    throw new Error(translations[lang].alertLoadTestError);
                }

                launchTest(questions);
            } catch (error) {
                alert(`${translations[lang].alertLoadTestError} ${error.message}`);
            }
        }

        async function startRandomTest() {
            try {
                const count = document.getElementById('random-question-count').value;
                const difficulty = document.getElementById('random-difficulty-select').value;
                const response = await fetch(`${API_BASE}/random/${count}/${difficulty}`);
                if (!response.ok) {
                    throw new Error(`${translations[lang].alertRandomTestError} ${response.status}`);
                }
                const questions = await response.json();
                if (!questions || !Array.isArray(questions) || questions.length === 0) {
                    throw new Error(translations[lang].alertRandomTestError);
                }
                launchTest(questions);
            } catch (error) {
                console.error('Error starting random test:', error);
                alert(translations[lang].alertRandomTestError);
            }
        }

        function launchTest(questions) {
            sessionStorage.setItem('testQuestions', JSON.stringify(questions));
            window.location.href = 'test-run.html';
        }

        document.getElementById('start-topic-test').addEventListener('click', startTestByTopic);
        document.getElementById('start-random-test').addEventListener('click', startRandomTest);

        loadTopics();
        applyLang();
    </script>
</body>
</html>
